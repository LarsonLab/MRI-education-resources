
<!DOCTYPE html>


<html lang="en" data-content_root="./" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Spectral-Spatial RF Pulses &#8212; Principles of MRI</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="_static/styles/sphinx-book-theme.css?v=eba8b062" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-design.min.css?v=95c83b7e" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script src="_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="_static/doctools.js?v=9a2dae69"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="_static/copybutton.js?v=f281be69"></script>
    <script src="_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="_static/design-tabs.js?v=f930bc37"></script>
    <script async="async" src="https://www.googletagmanager.com/gtag/js?id=UA-51903906-1"></script>
    <script>
                window.dataLayer = window.dataLayer || [];
                function gtag(){ dataLayer.push(arguments); }
                gtag('js', new Date());
                gtag('config', 'UA-51903906-1');
            </script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>
                window.dataLayer = window.dataLayer || [];
                function gtag(){ dataLayer.push(arguments); }
                gtag('js', new Date());
                gtag('config', 'UA-51903906-1');
            </script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'Spectral-Spatial RF Pulses';</script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Fun with RF Pulses?" href="Fun%20with%20RF%20Pulses.html" />
    <link rel="prev" title="RF Pulses" href="RF%20Pulses.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="Introduction.html">
  
  
  
  
  
    
    
      
    
    
    <img src="_static/HPBrain-Anime.png" class="logo__image only-light" alt="Principles of MRI - Home"/>
    <script>document.write(`<img src="_static/HPBrain-Anime.png" class="logo__image only-dark" alt="Principles of MRI - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="Introduction.html">
                    Introduction to Principles of MRI
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Magnetic Resonance Physics</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="MRI%20System.html">The MRI System</a></li>
<li class="toctree-l1"><a class="reference internal" href="Spin%20Physics.html">Spin Physics</a></li>
<li class="toctree-l1"><a class="reference internal" href="MR%20Physics%20-%20Bloch%20Equation.html">Bloch Equation</a></li>
<li class="toctree-l1"><a class="reference internal" href="Magnetic%20Fields%20and%20RF%20Coils.html">Magnetic fields in MRI</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">MR Experiment</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="Pulse%20Sequence.html">The Pulse Sequence</a></li>
<li class="toctree-l1"><a class="reference internal" href="Gradient%20and%20Spin%20Echoes.html">Gradient and Spin Echo Pulse Sequences</a></li>
<li class="toctree-l1"><a class="reference internal" href="MRI%20Contrast.html">MRI Contrast</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Image Formation</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="Spatial%20Encoding.html">Spatial Encoding</a></li>
<li class="toctree-l1"><a class="reference internal" href="K-space.html">K-space</a></li>
<li class="toctree-l1"><a class="reference internal" href="Image%20Reconstruction.html">Image Reconstruction</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Image Characteristics</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="Signal%20to%20Noise%20Ratio.html">Signal to Noise Ratio (SNR)</a></li>

<li class="toctree-l1"><a class="reference internal" href="FOV%20and%20Resolution.html">Field of View (FOV) and Resolution</a></li>
<li class="toctree-l1"><a class="reference internal" href="MRI%20Signal%20Equation.html">The MRI Signal Equation and K-space</a></li>
<li class="toctree-l1"><a class="reference internal" href="Artifacts.html">Artifacts</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Radiofrequency Pulses</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="RF%20Pulses.html">RF Pulses</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Spectral-Spatial RF Pulses</a></li>
<li class="toctree-l1"><a class="reference internal" href="Fun%20with%20RF%20Pulses.html">Fun with RF Pulses?</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Fast Imaging</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="Fast%20Imaging%20Pulse%20Sequences.html">Fast Imaging Pulse Sequences</a></li>
<li class="toctree-l1"><a class="reference internal" href="Accelerated%20Imaging%20Methods.html">Accelerated Imaging Methods</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Summary</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="Key%20MRI%20Concepts.html">Key MRI Concepts and Equations</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Reference Material</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="MRI%20Notation.html">MRI Notation and Terminology</a></li>
<li class="toctree-l1"><a class="reference internal" href="MRI%20Math%20Concepts.html">MRI Math Concepts</a></li>
<li class="toctree-l1"><a class="reference internal" href="Software_Resources.html">MRI Software Resources</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/larsonlab/MRI-education-resources" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/larsonlab/MRI-education-resources/issues/new?title=Issue%20on%20page%20%2FSpectral-Spatial RF Pulses.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="_sources/Spectral-Spatial RF Pulses.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm pst-navbar-icon search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Spectral-Spatial RF Pulses</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#learning-goals">Learning Goals</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#spectral-spatial-rf-pulse-design">Spectral-Spatial RF Pulse Design</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="spectral-spatial-rf-pulses">
<h1>Spectral-Spatial RF Pulses<a class="headerlink" href="#spectral-spatial-rf-pulses" title="Link to this heading">#</a></h1>
<p>Spectral-spatial RF pulses aim to provide both</p>
<ul class="simple">
<li><p>spectral selection, typically to only excite protons in water molecules, and not protons in lipids</p></li>
<li><p>spatial selection, for slice-selective imaging</p></li>
</ul>
<p>These are particularly common in fMRI and diffusion with echo-planar imaging (EPI) in order to eliminate chemical shift displacement artifacts in the image, and are also used for water and/or fat suppression in MR spectroscopy.</p>
<section id="learning-goals">
<h2>Learning Goals<a class="headerlink" href="#learning-goals" title="Link to this heading">#</a></h2>
<ol class="arabic simple">
<li><p>Describe how images are formed</p>
<ul class="simple">
<li><p>Understand how spectral-spatial RF pulses work</p></li>
</ul>
</li>
<li><p>Identify artifacts and how to mitigate them</p>
<ul class="simple">
<li><p>Determine when using spectral-spatial RF pulses would help remove chemical shift related artifacts</p></li>
</ul>
</li>
</ol>
</section>
<section id="spectral-spatial-rf-pulse-design">
<h2>Spectral-Spatial RF Pulse Design<a class="headerlink" href="#spectral-spatial-rf-pulse-design" title="Link to this heading">#</a></h2>
<p>This is done by creating a 2D excitation profile in both the spectral and spatial dimensions.  This is most easily interpreted through excitation k-space, where the RF energy deposited can be Fourier Transformed to reveal the approximate spectral-spatial profile created.</p>
<p>The gradient applied traverses spatial excitation k-space, while time traverses the spectral excitation k-space dimension, as demonstrated by the gradient and k-psace plot below</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-octave notranslate"><div class="highlight"><pre><span></span><span class="c">% setup MRI-education-resources path and requirements</span>
<span class="n">cd</span> <span class="p">.</span><span class="o">./</span>
<span class="n">startup</span>

<span class="c">% trick to compile abr() mex file</span>
<span class="n">abr</span><span class="p">([</span><span class="mi">1</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span> <span class="mi">0</span><span class="p">],</span> <span class="mi">0</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>warning: using the gnuplot graphics toolkit is discouraged

The gnuplot graphics toolkit is not actively maintained and has a number
of limitations that are unlikely to be fixed.  Communication with gnuplot
uses a one-directional pipe and limited information is passed back to the
Octave interpreter so most changes made interactively in the plot window
will not be reflected in the graphics properties managed by Octave.  For
example, if the plot window is closed with a mouse click, Octave will not
be notified and will not update its internal list of open figure windows.
The qt toolkit is recommended instead.
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>loading image
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>loading signal
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>error: MEX file now compiled, re-run code
error: called from
    abrx at line 31 column 1
    abr at line 31 column 12
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-octave notranslate"><div class="highlight"><pre><span></span><span class="c">% Demonstrate gradient and spectral-spatial k-space trajectoy</span>

<span class="n">GAMMA</span> <span class="p">=</span> <span class="mf">42.58</span><span class="p">;</span>
<span class="n">dt</span> <span class="p">=</span> <span class="mf">0.1</span><span class="p">;</span>

<span class="n">Nlobe</span> <span class="p">=</span> <span class="mi">20</span><span class="p">;</span>
<span class="n">Nspec</span> <span class="p">=</span> <span class="mi">10</span><span class="p">;</span>
<span class="n">Nramp</span> <span class="p">=</span> <span class="mi">4</span><span class="p">;</span>

<span class="n">ramp</span> <span class="p">=</span> <span class="p">[.</span><span class="mi">5</span><span class="p">:</span><span class="n">Nramp</span><span class="o">-</span><span class="p">.</span><span class="mi">5</span><span class="p">]</span><span class="o">/</span><span class="n">Nramp</span><span class="p">;</span>
<span class="n">g1</span> <span class="p">=</span> <span class="p">[</span><span class="n">ramp</span><span class="p">,</span> <span class="nb">ones</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">Nlobe</span><span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="n">Nramp</span><span class="p">),</span> <span class="n">ramp</span><span class="p">(</span><span class="k">end</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span><span class="mi">1</span><span class="p">)];</span> 

<span class="n">gamp</span> <span class="p">=</span> <span class="mf">0.95</span><span class="p">;</span>
<span class="n">g</span> <span class="p">=</span> <span class="p">[];</span>
<span class="k">for</span> <span class="n">k</span> <span class="p">=</span> <span class="mi">1</span><span class="p">:</span><span class="n">Nspec</span>
   <span class="n">g</span> <span class="p">=</span> <span class="p">[</span><span class="n">g</span><span class="p">,</span> <span class="p">(</span><span class="nb">mod</span><span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="mi">2</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">gamp</span><span class="o">*</span><span class="n">g1</span><span class="p">];</span>
<span class="k">end</span>

<span class="n">Nrw</span> <span class="p">=</span> <span class="nb">round</span><span class="p">((</span><span class="n">Nlobe</span> <span class="o">-</span> <span class="n">Nramp</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span> <span class="o">+</span> <span class="n">Nramp</span><span class="p">);</span>
<span class="n">grw</span> <span class="p">=</span> <span class="p">[</span><span class="n">ramp</span><span class="p">,</span> <span class="nb">ones</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">Nrw</span><span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="n">Nramp</span><span class="p">),</span> <span class="n">ramp</span><span class="p">(</span><span class="k">end</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span><span class="mi">1</span><span class="p">)];</span>

<span class="n">g</span> <span class="p">=</span> <span class="p">[</span><span class="n">g</span><span class="p">,</span> <span class="p">(</span><span class="nb">mod</span><span class="p">(</span><span class="n">Nspec</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="mi">2</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">gamp</span><span class="o">*</span><span class="n">grw</span><span class="p">];</span>

<span class="n">t</span> <span class="p">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="nb">length</span><span class="p">(</span><span class="n">g</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">dt</span><span class="p">;</span>
<span class="nb">subplot</span><span class="p">(</span><span class="mi">121</span><span class="p">)</span>
<span class="nb">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">g</span><span class="p">)</span>
<span class="nb">ylabel</span><span class="p">(</span><span class="s">&#39;G_z&#39;</span><span class="p">)</span>
<span class="nb">xlabel</span><span class="p">(</span><span class="s">&#39;Time&#39;</span><span class="p">)</span>

<span class="nb">subplot</span><span class="p">(</span><span class="mi">122</span><span class="p">)</span>
<span class="nb">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">GAMMA</span><span class="o">*</span><span class="n">dt</span><span class="o">*</span><span class="p">(</span><span class="nb">cumsum</span><span class="p">(</span><span class="n">g</span><span class="p">)</span> <span class="o">-</span> <span class="nb">sum</span><span class="p">(</span><span class="n">g</span><span class="p">)))</span>
<span class="nb">xlabel</span><span class="p">(</span><span class="s">&#39;k_f = t&#39;</span><span class="p">),</span> <span class="nb">ylabel</span><span class="p">(</span><span class="s">&#39;k_z&#39;</span><span class="p">)</span>
<span class="nb">title</span><span class="p">(</span><span class="s">&#39;k-space trajectory&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/69715e2336047ff571a969d429b53bb7722a79b5dc59362f751a77a42bd19f37.png" src="_images/69715e2336047ff571a969d429b53bb7722a79b5dc59362f751a77a42bd19f37.png" />
</div>
</div>
<p>To design the RF pulse, we can approximate the pulse and profile shape as separable function in frequency and space:</p>
<div class="math notranslate nohighlight">
\[ h(f,z) = h_f(f) h_z(z)\]</div>
<div class="math notranslate nohighlight">
\[ \mathcal{F}\{ h(f,z) \} = H(k_f, k_z) = H_f(k_f) H_z(k_z)\]</div>
<p>With this approximation, we can formulate the goal of the RF pulse design is to create and combine two pulses:</p>
<ul class="simple">
<li><p>A spectral pulse filter, <span class="math notranslate nohighlight">\(H_f(k_f)\)</span>, that should be applied in <span class="math notranslate nohighlight">\(k_f\)</span> direction</p></li>
<li><p>A spatial pulse filter, <span class="math notranslate nohighlight">\(H_z(k_z)\)</span>, that should be applied in the <span class="math notranslate nohighlight">\(k_z\)</span> direction</p></li>
</ul>
<p>Then design typically consists of 3 main steps</p>
<ol class="arabic simple">
<li><p>Design spectral pulse (envelope)</p></li>
<li><p>Design spatial sub-pulse</p></li>
<li><p>Combine spectral pulse envelope and spatial subpulses with an oscillating gradient</p></li>
</ol>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-octave notranslate"><div class="highlight"><pre><span></span><span class="c">% Design parameters</span>
<span class="n">GAMMA</span> <span class="p">=</span> <span class="mi">4258</span><span class="p">;</span> <span class="c">% Hz/G</span>
<span class="n">slewmax</span> <span class="p">=</span> <span class="mf">15e3</span><span class="p">;</span> <span class="c">% G/cm/s</span>
<span class="n">gmax</span> <span class="p">=</span> <span class="mi">4</span><span class="p">;</span> <span class="c">% G/cm</span>
<span class="n">T</span> <span class="p">=</span> <span class="mf">20e-3</span><span class="p">;</span> <span class="c">% ms</span>
<span class="n">TBW</span> <span class="p">=</span> <span class="mi">3</span><span class="p">;</span>
<span class="n">SBW</span> <span class="p">=</span> <span class="mi">6</span><span class="p">;</span>
<span class="n">dz</span> <span class="p">=</span> <span class="mf">0.5</span><span class="p">;</span> <span class="c">% cm, max spatial resolution</span>
<span class="n">Nspec</span> <span class="p">=</span> <span class="mi">10</span><span class="p">;</span>
<span class="n">DT</span> <span class="p">=</span> <span class="n">T</span><span class="o">/</span><span class="n">Nspec</span><span class="p">;</span>
<span class="n">dt</span> <span class="p">=</span> <span class="mf">10e-6</span><span class="p">;</span> <span class="c">% us</span>
<span class="n">flip</span> <span class="p">=</span> <span class="nb">pi</span><span class="o">/</span><span class="mi">4</span><span class="p">;</span>

<span class="c">% gradient parameters</span>
<span class="n">verse_frac</span> <span class="p">=</span> <span class="mf">0.8</span><span class="p">;</span>
<span class="n">Nlobe</span> <span class="p">=</span> <span class="n">DT</span><span class="o">/</span><span class="n">dt</span><span class="p">;</span>
<span class="n">Nspat</span> <span class="p">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">Nlobe</span> <span class="o">*</span> <span class="n">verse_frac</span><span class="p">);</span>
<span class="n">Nwait</span> <span class="p">=</span> <span class="p">(</span><span class="n">Nlobe</span> <span class="o">-</span> <span class="n">Nspat</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">;</span>

<span class="n">z</span> <span class="p">=</span> <span class="nb">linspace</span><span class="p">(</span><span class="o">-</span><span class="mf">0.8</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">,</span> <span class="mi">201</span><span class="p">);</span>
<span class="n">df</span> <span class="p">=</span> <span class="nb">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">500</span><span class="p">,</span> <span class="mi">500</span><span class="p">,</span> <span class="mi">201</span><span class="p">);</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-octave notranslate"><div class="highlight"><pre><span></span><span class="c">% 1. Spectral Pulse Design</span>

<span class="n">rfspec</span> <span class="p">=</span> <span class="n">dzrf</span><span class="p">(</span><span class="n">Nspec</span><span class="p">,</span> <span class="n">TBW</span><span class="p">);</span>
<span class="n">gf</span> <span class="p">=</span> <span class="mi">2</span><span class="o">*</span><span class="nb">pi</span><span class="o">*</span><span class="n">DT</span> <span class="o">*</span> <span class="nb">ones</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="nb">length</span><span class="p">(</span><span class="n">rfspec</span><span class="p">));</span>
<span class="n">mxy_f</span> <span class="p">=</span> <span class="n">ab2ex</span><span class="p">(</span><span class="n">abr</span><span class="p">(</span><span class="n">rfspec</span><span class="p">,</span> <span class="n">gf</span><span class="p">,</span> <span class="n">df</span><span class="p">));</span>

<span class="n">t</span> <span class="p">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="nb">length</span><span class="p">(</span><span class="n">rfspec</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">DT</span><span class="o">*</span><span class="mf">1e3</span><span class="p">;</span>
<span class="nb">subplot</span><span class="p">(</span><span class="mi">221</span><span class="p">)</span>
<span class="nb">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="nb">real</span><span class="p">(</span><span class="n">rfspec</span><span class="p">),</span> <span class="s">&#39;-x&#39;</span><span class="p">)</span>
<span class="nb">ylabel</span><span class="p">(</span><span class="s">&#39;RF&#39;</span><span class="p">)</span>
<span class="nb">title</span><span class="p">(</span><span class="s">&#39;Spectral Pulse Design&#39;</span><span class="p">)</span>
<span class="nb">subplot</span><span class="p">(</span><span class="mi">223</span><span class="p">)</span>
<span class="nb">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="nb">ones</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="nb">length</span><span class="p">(</span><span class="n">rfspec</span><span class="p">)))</span>
<span class="nb">ylabel</span><span class="p">(</span><span class="s">&#39;G_f&#39;</span><span class="p">)</span>
<span class="nb">xlabel</span><span class="p">(</span><span class="s">&#39;Time (ms)&#39;</span><span class="p">)</span>
<span class="nb">subplot</span><span class="p">(</span><span class="mi">122</span><span class="p">)</span>
<span class="nb">plot</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="nb">abs</span><span class="p">(</span><span class="n">mxy_f</span><span class="p">))</span>
<span class="nb">xlabel</span><span class="p">(</span><span class="s">&#39;Frequency (Hz)&#39;</span><span class="p">),</span> <span class="nb">ylabel</span><span class="p">(</span><span class="s">&#39;M_{XY}&#39;</span><span class="p">)</span>
<span class="nb">title</span><span class="p">(</span><span class="s">&#39;Spectral Profile&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/27c2a537ab9c42bdb2de40d2c747d6e628a76754cbc6c04d255618aa1cca6bc9.png" src="_images/27c2a537ab9c42bdb2de40d2c747d6e628a76754cbc6c04d255618aa1cca6bc9.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-octave notranslate"><div class="highlight"><pre><span></span><span class="c">% 2. Spatial pulse design</span>

<span class="n">rfspat</span> <span class="p">=</span> <span class="n">dzrf</span><span class="p">(</span><span class="n">Nspat</span><span class="p">,</span> <span class="n">SBW</span><span class="p">);</span>

<span class="c">% gradients (including ramp sampling)</span>
<span class="n">gamp</span> <span class="p">=</span> <span class="p">(</span><span class="n">SBW</span><span class="o">/</span><span class="n">DT</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">GAMMA</span><span class="o">*</span><span class="n">dz</span><span class="p">);</span> <span class="c">% gradient for spatial resolution</span>

<span class="c">% Uses a slew rate that can&#39;t be violated</span>
<span class="n">Nramp</span> <span class="p">=</span> <span class="nb">min</span><span class="p">(</span> <span class="nb">ceil</span><span class="p">(</span><span class="n">gmax</span><span class="o">/</span><span class="n">slewmax</span> <span class="o">/</span> <span class="n">dt</span><span class="p">),</span> <span class="nb">floor</span><span class="p">(</span><span class="n">Nlobe</span><span class="o">/</span><span class="mi">2</span><span class="p">));</span>
<span class="n">ramp</span> <span class="p">=</span> <span class="p">[.</span><span class="mi">5</span><span class="p">:</span><span class="n">Nramp</span><span class="o">-</span><span class="p">.</span><span class="mi">5</span><span class="p">]</span><span class="o">/</span><span class="n">Nramp</span><span class="p">;</span>
<span class="n">g1</span> <span class="p">=</span> <span class="p">[</span><span class="n">ramp</span><span class="p">,</span> <span class="nb">ones</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">Nlobe</span><span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="n">Nramp</span><span class="p">),</span> <span class="n">ramp</span><span class="p">(</span><span class="k">end</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span><span class="mi">1</span><span class="p">)];</span> 
<span class="c">% apply VERSE algorithm for time-varying gradient</span>
<span class="n">rfspatv</span> <span class="p">=</span> <span class="n">verse</span><span class="p">(</span><span class="n">g1</span><span class="p">,</span> <span class="p">[</span><span class="nb">zeros</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">floor</span><span class="p">(</span><span class="n">Nwait</span><span class="p">)),</span> <span class="n">rfspat</span><span class="p">(:).</span><span class="o">&#39;</span><span class="p">,</span> <span class="nb">zeros</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="nb">ceil</span><span class="p">(</span><span class="n">Nwait</span><span class="p">))]).</span><span class="o">&#39;</span><span class="p">;</span>
<span class="n">rfspatv</span><span class="p">(</span><span class="nb">find</span><span class="p">(</span><span class="nb">isnan</span><span class="p">(</span><span class="n">rfspatv</span><span class="p">)))</span> <span class="p">=</span> <span class="mi">0</span><span class="p">;</span>

<span class="n">g1z</span> <span class="p">=</span> <span class="mi">2</span><span class="o">*</span><span class="nb">pi</span><span class="o">*</span><span class="n">GAMMA</span><span class="o">*</span><span class="n">dt</span> <span class="o">*</span> <span class="n">gamp</span><span class="o">*</span> <span class="n">g1</span><span class="p">;</span>
<span class="n">mxy_z</span> <span class="p">=</span> <span class="n">ab2ex</span><span class="p">(</span><span class="n">abr</span><span class="p">(</span><span class="n">rfspatv</span><span class="p">,</span> <span class="n">g1z</span><span class="p">,</span> <span class="n">z</span><span class="p">));</span>

<span class="n">t</span> <span class="p">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="nb">length</span><span class="p">(</span><span class="n">g1</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">dt</span><span class="o">*</span><span class="mf">1e3</span><span class="p">;</span>
<span class="nb">subplot</span><span class="p">(</span><span class="mi">221</span><span class="p">)</span>
<span class="nb">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="nb">real</span><span class="p">(</span><span class="n">rfspatv</span><span class="p">))</span>
<span class="nb">ylabel</span><span class="p">(</span><span class="s">&#39;RF&#39;</span><span class="p">)</span>
<span class="nb">title</span><span class="p">(</span><span class="s">&#39;Spatial Pulse Design&#39;</span><span class="p">)</span>

<span class="nb">subplot</span><span class="p">(</span><span class="mi">223</span><span class="p">)</span>
<span class="nb">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">gamp</span><span class="o">*</span><span class="n">g1</span><span class="p">)</span>
<span class="nb">ylabel</span><span class="p">(</span><span class="s">&#39;G_z&#39;</span><span class="p">)</span>
<span class="nb">xlabel</span><span class="p">(</span><span class="s">&#39;Time (ms)&#39;</span><span class="p">)</span>

<span class="nb">subplot</span><span class="p">(</span><span class="mi">122</span><span class="p">)</span>
<span class="nb">plot</span><span class="p">(</span><span class="n">z</span><span class="p">,</span> <span class="nb">abs</span><span class="p">(</span><span class="n">mxy_z</span><span class="p">))</span>
<span class="nb">xlabel</span><span class="p">(</span><span class="s">&#39;Position (cm)&#39;</span><span class="p">),</span> <span class="nb">ylabel</span><span class="p">(</span><span class="s">&#39;M_{XY}&#39;</span><span class="p">)</span>
<span class="nb">title</span><span class="p">(</span><span class="s">&#39;Spatial Profile&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/ac59408c44670d705730a7d2b5e7a22a5b743938ecce8bbe8d24d8316a124a25.png" src="_images/ac59408c44670d705730a7d2b5e7a22a5b743938ecce8bbe8d24d8316a124a25.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-octave notranslate"><div class="highlight"><pre><span></span><span class="c">% 3. Combine spectral and spatial pulse designs</span>

<span class="n">rf</span> <span class="p">=</span> <span class="p">[];</span> <span class="n">g</span> <span class="p">=</span> <span class="p">[];</span>
<span class="k">for</span> <span class="n">k</span> <span class="p">=</span> <span class="mi">1</span><span class="p">:</span><span class="n">Nspec</span>
   <span class="n">rf</span> <span class="p">=</span> <span class="p">[</span><span class="n">rf</span><span class="p">,</span> <span class="n">rfspatv</span><span class="o">*</span><span class="n">rfspec</span><span class="p">(</span><span class="n">k</span><span class="p">)];</span>  <span class="c">% weight spatial sub-pulses by the spectral filter</span>
   <span class="n">g</span> <span class="p">=</span> <span class="p">[</span><span class="n">g</span><span class="p">,</span> <span class="p">(</span><span class="nb">mod</span><span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="mi">2</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">gamp</span><span class="o">*</span><span class="n">g1</span><span class="p">];</span>  <span class="c">% oscillate gradient</span>
<span class="k">end</span>

<span class="c">% add spatial refocusing gradient</span>
<span class="n">Nrw</span> <span class="p">=</span> <span class="nb">round</span><span class="p">((</span><span class="n">Nlobe</span> <span class="o">-</span> <span class="n">Nramp</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span> <span class="o">+</span> <span class="n">Nramp</span><span class="p">);</span>
<span class="n">grw</span> <span class="p">=</span> <span class="p">[</span><span class="n">ramp</span><span class="p">,</span> <span class="nb">ones</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">Nrw</span><span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="n">Nramp</span><span class="p">),</span> <span class="n">ramp</span><span class="p">(</span><span class="k">end</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span><span class="mi">1</span><span class="p">)];</span>

<span class="n">g</span> <span class="p">=</span> <span class="p">[</span><span class="n">g</span><span class="p">,</span> <span class="p">(</span><span class="nb">mod</span><span class="p">(</span><span class="n">Nspec</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="mi">2</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">gamp</span><span class="o">*</span><span class="n">grw</span><span class="p">];</span>
<span class="n">rf</span> <span class="p">=</span> <span class="p">[</span><span class="n">rf</span><span class="p">,</span> <span class="nb">zeros</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">Nrw</span><span class="p">)];</span>

<span class="c">% scale RF pulse</span>
<span class="n">flip_scale</span> <span class="p">=</span> <span class="n">flip</span><span class="o">/</span><span class="nb">sum</span><span class="p">(</span><span class="n">rf</span><span class="p">);</span>
<span class="n">rf</span> <span class="p">=</span> <span class="n">flip_scale</span><span class="o">*</span><span class="n">rf</span><span class="p">;</span>
<span class="n">rfs</span> <span class="p">=</span> <span class="n">rfscaleg</span><span class="p">(</span><span class="n">rf</span><span class="p">,</span> <span class="n">T</span><span class="p">);</span>

<span class="nb">figure</span>
<span class="nb">subplot</span><span class="p">(</span><span class="mi">211</span><span class="p">)</span>
<span class="nb">plot</span><span class="p">([</span><span class="mi">0</span><span class="p">:</span><span class="nb">length</span><span class="p">(</span><span class="n">rf</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">dt</span><span class="o">*</span><span class="mf">1e3</span><span class="p">,</span> <span class="nb">real</span><span class="p">(</span><span class="n">rf</span><span class="p">),</span> <span class="p">...</span>
    <span class="p">[</span><span class="mf">0.5</span><span class="p">:</span><span class="mi">1</span><span class="p">:</span><span class="nb">length</span><span class="p">(</span><span class="n">rfspec</span><span class="p">)</span><span class="o">-</span><span class="mf">0.5</span><span class="p">]</span><span class="o">*</span><span class="n">DT</span><span class="o">*</span><span class="mf">1e3</span><span class="p">,</span> <span class="nb">real</span><span class="p">(</span><span class="n">rfspec</span><span class="p">)</span><span class="o">/</span><span class="nb">max</span><span class="p">(</span><span class="nb">real</span><span class="p">(</span><span class="n">rfspec</span><span class="p">))</span> <span class="o">*</span> <span class="nb">max</span><span class="p">(</span><span class="nb">real</span><span class="p">(</span><span class="n">rf</span><span class="p">)),</span> <span class="s">&#39;--&#39;</span><span class="p">)</span>
    <span class="nb">legend</span><span class="p">(</span><span class="s">&#39;RF pulse&#39;</span><span class="p">,</span> <span class="s">&#39;Spectral pulse envelope&#39;</span><span class="p">)</span>
<span class="nb">ylabel</span><span class="p">(</span><span class="s">&#39;RF&#39;</span><span class="p">)</span>
<span class="nb">title</span><span class="p">(</span><span class="s">&#39;Spectral-Spatial RF Pulse&#39;</span><span class="p">)</span>
<span class="nb">subplot</span><span class="p">(</span><span class="mi">212</span><span class="p">)</span>
<span class="nb">plot</span><span class="p">([</span><span class="mi">0</span><span class="p">:</span><span class="nb">length</span><span class="p">(</span><span class="n">rf</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">dt</span><span class="o">*</span><span class="mf">1e3</span><span class="p">,</span> <span class="n">g</span><span class="p">)</span>
<span class="nb">ylabel</span><span class="p">(</span><span class="s">&#39;G_z&#39;</span><span class="p">)</span>
<span class="nb">xlabel</span><span class="p">(</span><span class="s">&#39;Time (ms)&#39;</span><span class="p">)</span>

<span class="nb">figure</span>
<span class="n">plot3</span><span class="p">([</span><span class="o">-</span><span class="nb">length</span><span class="p">(</span><span class="n">rf</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">:</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">dt</span><span class="o">*</span><span class="mf">1e3</span><span class="p">,</span> <span class="n">GAMMA</span><span class="o">*</span><span class="n">dt</span><span class="o">*</span><span class="p">(</span><span class="nb">cumsum</span><span class="p">(</span><span class="n">g</span><span class="p">)</span> <span class="o">-</span> <span class="nb">sum</span><span class="p">(</span><span class="n">g</span><span class="p">)),</span> <span class="nb">real</span><span class="p">(</span><span class="n">rf</span><span class="p">))</span>
<span class="nb">xlabel</span><span class="p">(</span><span class="s">&#39;k_f = t&#39;</span><span class="p">),</span> <span class="nb">ylabel</span><span class="p">(</span><span class="s">&#39;k_z&#39;</span><span class="p">)</span>
<span class="nb">title</span><span class="p">(</span><span class="s">&#39;B_1(k)&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/4aaf0e1c0b3012366a775dd966a8ad9d31634a27acda65e588efae2bb2f380d2.png" src="_images/4aaf0e1c0b3012366a775dd966a8ad9d31634a27acda65e588efae2bb2f380d2.png" />
<img alt="_images/89ea0408e4318413236f0ac21f4a9512629f9c2a2076adbd7975cdee41b1e2a6.png" src="_images/89ea0408e4318413236f0ac21f4a9512629f9c2a2076adbd7975cdee41b1e2a6.png" />
</div>
</div>
<p>The spectral pulse, <span class="math notranslate nohighlight">\(H_f(k_f)\)</span>, creates the overall envelope, and is applied as a weighting for repeated versions of the spatial pulse, <span class="math notranslate nohighlight">\(H_z(k_z)\)</span>.  This creates the excitation k-space profile, <span class="math notranslate nohighlight">\(B_1(k_f, k_z)\)</span> shown above, which results in the spectral-spatial profile shown below:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-octave notranslate"><div class="highlight"><pre><span></span><span class="n">gz</span> <span class="p">=</span> <span class="mi">2</span><span class="o">*</span><span class="nb">pi</span><span class="o">*</span><span class="n">GAMMA</span><span class="o">*</span><span class="n">dt</span> <span class="o">*</span> <span class="n">g</span><span class="p">;</span>
<span class="n">gf</span> <span class="p">=</span> <span class="mi">2</span><span class="o">*</span><span class="nb">pi</span><span class="o">*</span><span class="n">dt</span> <span class="o">*</span> <span class="nb">ones</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="nb">length</span><span class="p">(</span><span class="n">rf</span><span class="p">));</span>

<span class="n">mxy_2d</span> <span class="p">=</span> <span class="n">ab2ex</span><span class="p">(</span><span class="n">abr</span><span class="p">(</span><span class="n">rf</span><span class="p">,</span> <span class="n">gz</span> <span class="o">+</span> <span class="n">i</span><span class="o">*</span><span class="n">gf</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">df</span><span class="p">));</span>


<span class="nb">figure</span>
<span class="nb">imagesc</span><span class="p">(</span><span class="n">df</span><span class="p">,</span><span class="n">z</span><span class="p">,</span><span class="nb">abs</span><span class="p">(</span><span class="n">mxy_2d</span><span class="p">))</span>
<span class="nb">xlabel</span><span class="p">(</span><span class="s">&#39;Frequency (Hz)&#39;</span><span class="p">),</span> <span class="nb">ylabel</span><span class="p">(</span><span class="s">&#39;Position (cm)&#39;</span><span class="p">)</span>
<span class="nb">title</span><span class="p">(</span><span class="s">&#39;Spectral-spatial Profile (M_XY)&#39;</span><span class="p">)</span>
<span class="c">%colormap(gray)</span>
<span class="nb">colorbar</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/1cb12c9b5a40bb3e160c1083820138616ba098ef4da6fc18e3eddcc9529868fc.png" src="_images/1cb12c9b5a40bb3e160c1083820138616ba098ef4da6fc18e3eddcc9529868fc.png" />
</div>
</div>
<p>Watch how the transverse magnetization evolves during the spectral-spatial RF pulse:</p>
<p><img alt="spectral_spatial_RF_animation.gif" src="_images/spectral_spatial_RF_animation.gif" /></p>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "octave"
        },
        kernelOptions: {
            name: "octave",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'octave'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="RF%20Pulses.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">RF Pulses</p>
      </div>
    </a>
    <a class="right-next"
       href="Fun%20with%20RF%20Pulses.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Fun with RF Pulses?</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#learning-goals">Learning Goals</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#spectral-spatial-rf-pulse-design">Spectral-Spatial RF Pulse Design</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Peder Larson
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2024.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
<div class="extra_footer">
  Citation - DOI <a href="https://doi.org/10.5281/zenodo.5547020">10.5281/zenodo.5547020</a>
</div>
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>